{{- $img := .Page.Resources.GetMatch .Destination -}}
{{- if and (not $img) .Page.File -}}
  {{- $path := path.Join .Page.File.Dir .Destination -}}
  {{- $img = resources.Get $path -}}
{{- end -}}

{{- if $img -}}
  {{- $small := $img.Resize "800x" -}}
  {{- $medium := $img.Resize "1200x" -}}
  {{- $large := $img.Resize "1600x" -}}
  
  <figure class="image-container">
    <img 
      srcset="
        {{ $small.RelPermalink }} 800w,
        {{ $medium.RelPermalink }} 1200w,
        {{ $large.RelPermalink }} 1600w"
      sizes="(max-width: 800px) 100vw, 800px"
      src="{{ $img.RelPermalink }}" 
      alt="{{ .Text }}"
      loading="lazy"
      width="{{ $img.Width }}"
      height="{{ $img.Height }}"
      class="img-fluid"
    >
    {{- if .Title -}}
      <figcaption class="text-center mt-2 text-muted">{{ .Title }}</figcaption>
    {{- end -}}
  </figure>
{{- else -}}
  <img 
    src="{{ .Destination | safeURL }}" 
    alt="{{ .Text }}" 
    loading="lazy"
    class="img-fluid"
  >
{{- end -}}
