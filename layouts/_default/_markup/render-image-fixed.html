{{- if hasPrefix (lower .Destination) "http" -}}
  {{/* Handle external images */}}
  <figure class="image-container">
    <img 
      src="{{ .Destination }}" 
      alt="{{ .Text }}" 
      loading="lazy"
      class="img-fluid"
      {{ with .Title }}title="{{ . }}"{{ end }}
    >
    {{ with .Title }}
      <figcaption class="text-center mt-2 text-muted">{{ . }}</figcaption>
    {{ end }}
  </figure>
{{- else -}}
  {{/* Handle local images */}}
  {{- $img := .Page.Resources.GetMatch .Destination -}}
  {{- if and (not $img) .Page.File -}}
    {{- $path := path.Join .Page.File.Dir .Destination -}}
    {{- $img = resources.Get $path -}}
  {{- end -}}

  {{- if $img -}}
    {{- $small := $img.Resize "800x" -}}
    {{- $medium := $img.Resize "1200x" -}}
    {{- $large := $img.Resize "1600x" -}}
    
    <figure class="image-container">
      <img 
        srcset="
          {{ $small.RelPermalink }} 800w,
          {{ $medium.RelPermalink }} 1200w,
          {{ $large.RelPermalink }} 1600w"
        sizes="(max-width: 800px) 100vw, 800px"
        src="{{ $img.RelPermalink }}" 
        alt="{{ .Text }}" 
        loading="lazy"
        width="{{ $img.Width }}"
        height="{{ $img.Height }}"
        class="img-fluid"
        {{ with .Title }}title="{{ . }}"{{ end }}
      >
      {{ with .Title }}
        <figcaption class="text-center mt-2 text-muted">{{ . }}</figcaption>
      {{ end }}
    </figure>
  {{- else -}}
    {{/* Fallback for local images that can't be found */}}
    <img 
      src="{{ .Destination | relURL }}" 
      alt="{{ .Text }}" 
      loading="lazy"
      class="img-fluid"
      {{ with .Title }}title="{{ . }}"{{ end }}
    >
  {{- end -}}
{{- end -}}
